<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TRXjs</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
  :root{
    --bg:#0b0b0b;
    --panel:#0f0f0f;
    --muted:#bfbfbf;
    --accent:#ffffff;
    --glass: rgba(255,255,255,0.04);
    --radius:14px;
    --gap:14px;
  }
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b0b0b 0%, #070707 100%);color:var(--accent);-webkit-font-smoothing:antialiased}
  .app{display:grid;grid-template-columns:320px 1fr 360px;gap:var(--gap);height:100vh;padding:20px}
  .sidebar{background:var(--panel);border-radius:var(--radius);padding:18px;display:flex;flex-direction:column;gap:12px;box-shadow:0 6px 18px rgba(0,0,0,0.7);overflow:auto}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#ffffff 0%, #dddddd 100%);display:flex;align-items:center;justify-content:center;color:#000;font-weight:700;font-size:18px;box-shadow:0 6px 18px rgba(255,255,255,0.03)}
  .title{font-size:15px;font-weight:700}
  .subtitle{font-size:12px;color:var(--muted);margin-top:-4px}
  .nav{display:flex;gap:8px;background:var(--glass);padding:8px;border-radius:12px}
  .nav button{flex:1;padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);cursor:pointer;transition:all .18s}
  .nav button.active{background:var(--accent);color:#000;border:0;transform:translateY(-3px);box-shadow:0 10px 30px rgba(255,255,255,0.03)}
  .list{display:grid;gap:8px;margin-top:6px}
  .group-title{font-size:13px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
  .item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);cursor:pointer;transition:transform .14s}
  .item:hover{transform:translateY(-6px)}
  .item .left{display:flex;align-items:center;gap:12px}
  .badge{min-width:40px;height:40px;border-radius:10px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-weight:700}
  .item .meta{display:flex;flex-direction:column}
  .item .meta .name{font-size:14px}
  .item .meta .small{font-size:12px;color:var(--muted);margin-top:4px}
  .complete{background:linear-gradient(90deg,#fff 0%, #ddd 100%);color:#000}
  .center{display:flex;align-items:center;justify-content:center}
  .main{background:linear-gradient(180deg,#0e0e0e 0%, #0b0b0b 100%);border-radius:var(--radius);padding:22px;display:flex;flex-direction:column;gap:18px;overflow:auto;box-shadow:0 8px 30px rgba(0,0,0,0.7)}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .progress-wrap{display:flex;align-items:center;gap:18px}
  .progress-circle{width:120px;height:120px;display:flex;align-items:center;justify-content:center;position:relative}
  .progress-circle svg{transform:rotate(-90deg)}
  .progress-number{position:absolute;font-weight:800;font-size:20px}
  .controls{display:flex;gap:10px;align-items:center}
  .btn{padding:10px 14px;border-radius:12px;border:0;background:transparent;color:var(--accent);cursor:pointer;outline:none;border:1px solid rgba(255,255,255,0.06);transition:all .15s}
  .btn.primary{background:var(--accent);color:#000;border:0;transform:translateY(-2px);box-shadow:0 12px 30px rgba(255,255,255,0.03)}
  .content{display:grid;grid-template-columns:1fr;gap:16px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:16px;border-radius:12px}
  .lesson-title{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .lesson-body{margin-top:8px;color:var(--muted);line-height:1.5}
  .actions{display:flex;gap:8px;margin-top:12px}
  .comment-area{margin-top:12px;display:flex;flex-direction:column;gap:8px}
  .comment-area textarea{min-height:80px;padding:12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent);resize:vertical}
  .comment-list{margin-top:8px;display:flex;flex-direction:column;gap:8px}
  .comment{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:13px;color:var(--muted)}
  .rightbar{background:var(--panel);border-radius:var(--radius);padding:18px;display:flex;flex-direction:column;gap:12px;overflow:auto}
  .idea-area textarea{min-height:120px;padding:12px;border-radius:12px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent);resize:vertical}
  .small{font-size:12px;color:var(--muted)}
  .link{display:inline-block;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);text-decoration:none;color:var(--accent);transition:all .12s}
  .link:hover{transform:translateY(-4px)}
  .footer{margin-top:auto;font-size:12px;color:var(--muted);text-align:center}
  .complete-badge{padding:8px 12px;border-radius:999px;background:linear-gradient(90deg,#fff,#ddd);color:#000;font-weight:700;display:inline-block}
  .searchbar{display:flex;gap:8px;align-items:center}
  .kv{display:flex;gap:8px;align-items:center}
  .meta-pill{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:12px;color:var(--muted)}
  @media(max-width:980px){
    .app{grid-template-columns:1fr;grid-template-rows:auto 1fr auto;padding:14px}
    .rightbar{order:3}
    .sidebar{order:1}
    .main{order:2}
    .logo{width:40px;height:40px}
  }
  body.landing-centered {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #0b0b0b;
    font-family: sans-serif;
  }
  .container {
    display: flex;
    flex-direction: column;
    gap: 28px;
    align-items: center;
  }
  .zx, .vx, .cx {
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .zx button,
  .vx button,
  .cx button {
    width: 360px;
    height: 100px;
    font-size: 28px;
    font-weight: 600;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display:block;
  }
  .zx button a,
  .vx button a,
  .cx button a { text-decoration:none;color:inherit;display:block;width:100%;height:100%;line-height:100px }
  .zx button { backdrop-filter: blur(12px); background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); color:#fff; }
  .vx button { background:#0d1117; border:1px solid #30363d; color:#f0f6fc; }
  .cx button { background: linear-gradient(135deg, #00c6ff, #0072ff); color:#fff; box-shadow: 0 10px 30px rgba(0, 114, 255, 0.4); }
  .landing-top { text-align:center; margin-bottom:12px; color:var(--muted) }
  .back-to-landing { position: absolute; left: 18px; top: 18px; z-index: 9999; }

 
.app {
  display: grid;
  grid-template-columns: 320px 1fr 360px;
  gap: var(--gap);
  padding: 20px;
  height: auto;
}

.sidebar, .main, .rightbar {
  overflow: visible;
  max-height: none;
}

@media (max-width: 1024px) {
  .app {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto auto;
    padding: 10px;
  }
  .sidebar, .main, .rightbar {
    margin-bottom: var(--gap);
  }
}

  </style>
</head>
<body class="landing-centered">
  <div id="landing" class="container" style="max-width:920px;margin:auto;padding:20px;">
    <div style="text-align:center;color:var(--accent);margin-bottom:6px">
      <h1 style="margin:0">trxJS</h1>
      <div class="landing-top">впринцепе норм тема</div>
    </div>
    <div class="zx">
      <i class="fa-solid fa-book-open" style="font-size:64px;color:var(--accent);margin-bottom:6px"></i>
      <button onclick="openExternal('https://itproger.com/course/javascript')"><a>Курс</a></button>
    </div>
    <div class="vx">
      <i class="fa-solid fa-laptop-code" style="font-size:64px;color:var(--accent);margin-bottom:6px"></i>
      <button onclick="openExternal('https://itproger.com/practice/javascript')"><a>Практики</a></button>
    </div>
    <div class="cx">
      <i class="fa-solid fa-chart-line" style="font-size:64px;color:var(--accent);margin-bottom:6px"></i>
      <button id="openTrackerBtn"><a>Трекер</a></button>
    </div>
  </div>
  <div id="trackerWrapper" style="display:none;position:relative;height:100vh;">
    <button class="btn back-to-landing" onclick="showLanding()" style="border-radius:12px;padding:10px 12px;background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.06)">
      ← Назад
    </button>
    <div class="app" id="trackerApp">
      <aside class="sidebar">
        <div class="brand">
          <div class="logo">JS</div>
          <div>
            <div class="title">Курс JavaScript</div>
            <div class="subtitle">15 уроков · 50 практик</div>
          </div>
        </div>
        <div class="nav">
          <button id="btnLessons" class="active">Уроки</button>
          <button id="btnPractices">Практики</button>
          <button id="btnAll">Все</button>
        </div>
        <div class="list" id="listContainer"></div>
        <div class="footer">Сохранено в браузере · Тёмная тема</div>
      </aside>
      <main class="main">
        <div class="topbar">
          <div class="progress-wrap">
            <div class="progress-circle" id="progressWrap">
              <svg width="120" height="120">
                <defs>
                  <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
                    <stop offset="0" stop-color="#fff"/>
                    <stop offset="1" stop-color="#ddd"/>
                  </linearGradient>
                </defs>
                <circle cx="60" cy="60" r="50" stroke="rgba(255,255,255,0.04)" stroke-width="12" fill="none"></circle>
                <circle id="progressRing" cx="60" cy="60" r="50" stroke="url(#g1)" stroke-width="12" stroke-linecap="round" fill="none" stroke-dasharray="314" stroke-dashoffset="314"></circle>
              </svg>
              <div class="progress-number" id="progressNumber">0%</div>
            </div>
            <div>
              <div style="font-weight:800;font-size:16px">Твой прогресс</div>
              <div class="small" id="progressText">0 из 30 завершено</div>
              <div style="margin-top:8px" id="progressBars"></div>
            </div>
          </div>
          <div class="controls">
            <div class="kv">
              <div class="meta-pill" id="currentLessonP">Урок 1</div>
              <div class="meta-pill" id="currentPracticeP">Практика 1</div>
            </div>
            <button class="btn" id="resetBtn">Сбросить</button>
            <button class="btn primary" id="exportBtn">Экспорт</button>
          </div>
        </div>
        <section class="content" id="mainContent">
          <div class="card" id="detailCard">
            <div class="lesson-title">
              <div>
                <div id="detailTitle" style="font-weight:800;font-size:18px">Добро пожаловать</div>
                <div class="small" id="detailSub">Выбери урок или практику слева</div>
              </div>
              <div class="center">
                <a class="link" id="openHref" href="#" target="_blank">Открыть</a>
              </div>
            </div>
            <div class="lesson-body" id="detailBody">
              Здесь появится содержимое выбранного урока или практики.
            </div>
            <div class="actions" id="detailActions" style="display:none">
              <button class="btn" id="markBtn">Отметить как пройдено</button>
            </div>
            <div class="comment-area" id="commentArea" style="display:none">
              <textarea id="commentInput" placeholder="Оставь комментарий..."></textarea>
              <div style="display:flex;gap:8px">
                <button class="btn" id="saveComment">Сохранить комментарий</button>
                <button class="btn" id="clearComments">Очистить комментарии</button>
              </div>
              <div class="comment-list" id="commentList"></div>
            </div>
          </div>
          <div class="card" id="lessonListCard">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:800">Быстрый обзор</div>
              <div class="small">Нажми элемент слева чтобы открыть</div>
            </div>
            <div style="margin-top:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px">
              <div style="padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)">
                <div style="font-size:14px;font-weight:700">Уроки завершено</div>
                <div id="countLessons" style="font-weight:800;font-size:22px;margin-top:8px">0 / 15</div>
              </div>
              <div style="padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)">
                <div style="font-size:14px;font-weight:700">Практики завершено</div>
                <div id="countPractices" style="font-weight:800;font-size:22px;margin-top:8px">0 / 50</div>
              </div>
              <div style="padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)">
                <div style="font-size:14px;font-weight:700">Осталось</div>
                <div id="countLeft" style="font-weight:800;font-size:22px;margin-top:8px">65</div>
              </div>
            </div>
          </div>
        </section>
      </main>
      <aside class="rightbar">
        <div style="font-weight:800">Мои идеи</div>
        <div class="small">Быстрый черновик — сохраняется в браузере</div>
        <div class="idea-area">
          <textarea id="ideaInput" placeholder="Пиши идеи, заметки, анимации..."></textarea>
          <div style="display:flex;gap:8px">
            <button class="btn primary" id="saveIdea">Сохранить идею</button>
            <button class="btn" id="clearIdea">Очистить</button>
          </div>
        </div>
        <div style="margin-top:8px">
          <div style="font-weight:800">Статистика</div>
          <div class="small" id="statText">Загрузка...</div>
        </div>
        <div style="margin-top:12px">
          <div style="font-weight:800">Ссылки</div>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <a class="link" href="https://developer.mozilla.org/ru/docs/Web/JavaScript" target="_blank">MDN JavaScript</a>
            <a class="link" href="https://developer.mozilla.org/ru/docs/Web/API/Console" target="_blank">Console API</a>
          </div>
        </div>
      </aside>
    </div>
    <div id="congratsModal" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.6)">
      <div style="background:#fff;color:#000;padding:28px;border-radius:18px;max-width:680px;width:92%;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,0.6);">
        <div style="font-size:28px;font-weight:900">Поздравляю — ты прошёл курс!</div>
        <div style="margin-top:12px;color:#222">100% прогресса достигнуто. Гордись собой — теперь ты знаешь основы JavaScript.</div>
        <div style="margin-top:20px;display:flex;gap:10px;justify-content:center">
          <button class="btn primary" id="closeCongrats">Закрыть</button>
          <button class="btn" id="exportCongrats">Скачать отчёт</button>
        </div>
      </div>
    </div>
  </div>
  <script>
  function openExternal(url){
    window.open(url, '_blank');
  }
  const landingDiv = document.getElementById('landing');
  const trackerWrapper = document.getElementById('trackerWrapper');
  document.getElementById('openTrackerBtn').addEventListener('click', () => { showTracker(); });
  function showTracker(){
    landingDiv.style.display = 'none';
    trackerWrapper.style.display = 'block';
    document.body.classList.remove('landing-centered');
  }
  function showLanding(){
    trackerWrapper.style.display = 'none';
    landingDiv.style.display = 'block';
    document.body.classList.add('landing-centered');
  }
  const TOTAL_LESSONS = 15;
  const TOTAL_PRACTICES = 50;
  const STORAGE_KEY = 'js_course_state_v3';
  const IDEAS_KEY = 'js_course_ideas_v1';
  const lessonLinks = [
    "https://youtu.be/fHl7UyRjOf0?si=beznsi2qX5qJu_U_",
    "https://youtu.be/ujsgFnm2VKw?si=dD1BB6ZjCQxFl5mE",
    "https://youtu.be/WLsFBu_15Hw?si=v_Xu7c6EcbIH6bQz",
    "https://youtu.be/UHqnpHEXtII?si=n_WWXOj2S1z7IpJm",
    "https://youtu.be/tPjVEiOvgwE?si=q2j3XG8OnxK0HzOl",
    "https://youtu.be/TE0S9G3C4vU?si=CPMuuu_5HEiklFzl",
    "https://youtu.be/9zVAHOiQYBo?si=MGP4j-2X7aCa36je",
    "https://youtu.be/H39s52IW3bk?si=3Mt_wQS1wIKEDBwt",
    "https://youtu.be/UCSuoEJ50G8?si=NAqwzdltxyQdOv-W",
    "https://youtu.be/yUTwuyfTsOc?si=bvkB-sh6V8rNdghe",
    "https://youtu.be/Tw-_axj7Jis?si=rnwkbVmbptwuAMZN",
    "https://youtu.be/1nzH6WCEonQ?si=ZWpSF3yFk-wi0xZZ",
    "https://youtu.be/M_4ePNcric0?si=6W3kmia8Oa1I14qb",
    "https://youtu.be/jtw15FBCETE?si=19MUaW49v7JjXHoz",
    "https://youtu.be/QDA_EBJ0iSM?si=FHcEtI52LDSaYl6p"
  ];
  const INITIAL_STATE = {
    lessonsCompleted: 0,
    practicesCompleted: 0,
    currentLesson: 1,
    currentPractice: 1,
    items: {},
    ideas: ''
  };
  let state = loadState();
  let currentFilter = 'lessons';
  function loadState(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const parsed = JSON.parse(raw);
        if (!parsed.items) parsed.items = {};
        ensureAllItems(parsed);
        recalcCounts(parsed);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed));
        return parsed;
      }
    } catch(e){ console.warn('loadState error', e); }
    const obj = JSON.parse(JSON.stringify(INITIAL_STATE));
    for (let i = 1; i <= TOTAL_LESSONS; i++){
      obj.items['lesson-'+i] = {
        type: 'lesson',
        id: i,
        title: `Урок ${i}`,
        desc: `Краткое содержание урока ${i}`,
        href: lessonLinks[i-1] || "#",
        completed: false
      };
    }
    for (let p = 1; p <= TOTAL_PRACTICES; p++){
      obj.items['practice-'+p] = {
        type: 'practice',
        id: p,
        title: `Практика ${p}`,
        desc: `Задание практики ${p}`,
        href: "#",
        completed: false
      };
    }
    recalcCounts(obj);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
    return obj;
  }
  function ensureAllItems(s){
    for (let i = 1; i <= TOTAL_LESSONS; i++){
      const key = 'lesson-'+i;
      if (!s.items[key]){
        s.items[key] = { type:'lesson', id:i, title:`Урок ${i}`, desc:`Краткое содержание урока ${i}`, href:lessonLinks[i-1]||"#", completed:false };
      }
    }
    for (let i = 1; i <= TOTAL_PRACTICES; i++){
      const key = 'practice-'+i;
      if (!s.items[key]){
        s.items[key] = { type:'practice', id:i, title:`Практика ${i}`, desc:`Задание практики ${i}`, href:"#", completed:false };
      }
    }
    recalcCounts(s);
  }
  function recalcCounts(s){
    let lc=0, pc=0;
    for (const k in s.items){
      const it = s.items[k];
      if (it.completed){
        if (it.type==='lesson') lc++;
        if (it.type==='practice') pc++;
      }
    }
    s.lessonsCompleted = lc;
    s.practicesCompleted = pc;
  }
  function saveState(s=state){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
    updateUI();
  }
  function updateUI(){
    renderList(currentFilter);
    updateProgressVisual();
    document.getElementById('countLessons').textContent = `${state.lessonsCompleted} / ${TOTAL_LESSONS}`;
    document.getElementById('countPractices').textContent = `${state.practicesCompleted} / ${TOTAL_PRACTICES}`;
    document.getElementById('countLeft').textContent = `${(TOTAL_LESSONS+TOTAL_PRACTICES) - (state.lessonsCompleted+state.practicesCompleted)}`;
    document.getElementById('currentLessonP').textContent = `Урок ${state.currentLesson}`;
    document.getElementById('currentPracticeP').textContent = `Практика ${state.currentPractice}`;
    document.getElementById('statText').textContent = `Уроки: ${state.lessonsCompleted}/${TOTAL_LESSONS} · Практики: ${state.practicesCompleted}/${TOTAL_PRACTICES}`;
    const subtitleEl = document.querySelector('.subtitle');
    if (subtitleEl) subtitleEl.textContent = `${TOTAL_LESSONS} уроков · ${TOTAL_PRACTICES} практик`;
    document.getElementById('ideaInput').value = localStorage.getItem(IDEAS_KEY) || '';
  }
  function renderList(filter){
    const container = document.getElementById('listContainer');
    container.innerHTML = '';
    const lessonsDiv = document.createElement('div');
    lessonsDiv.innerHTML = `<div class="group-title">Уроки <span class="small">${TOTAL_LESSONS}</span></div>`;
    for (let i = 1; i <= TOTAL_LESSONS; i++){
      const key = 'lesson-'+i;
      const item = state.items[key];
      if (!item) continue;
      const el = document.createElement('div'); el.className = 'item'; el.dataset.key = key;
      const left = document.createElement('div'); left.className = 'left';
      const badge = document.createElement('div'); badge.className = 'badge'; badge.textContent = i;
      if (item.completed) badge.classList.add('complete');
      const meta = document.createElement('div'); meta.className = 'meta';
      const name = document.createElement('div'); name.className = 'name'; name.textContent = item.title;
      const small = document.createElement('div'); small.className = 'small'; small.textContent = item.desc;
      meta.appendChild(name); meta.appendChild(small);
      left.appendChild(badge); left.appendChild(meta);
      const right = document.createElement('div'); right.className = 'right';
      const a = document.createElement('a'); a.href = item.href || '#'; a.textContent = 'Открыть'; a.className = 'link'; a.target = '_blank';
      right.appendChild(a);
      el.appendChild(left); el.appendChild(right);
      el.addEventListener('click', (e) => {
        if (e.target && e.target.tagName === 'A') return;
        openDetail(key);
      });
      lessonsDiv.appendChild(el);
    }
    const practicesDiv = document.createElement('div');
    practicesDiv.innerHTML = `<div class="group-title" style="margin-top:12px">Практики <span class="small">${TOTAL_PRACTICES}</span></div>`;
    for (let i = 1; i <= TOTAL_PRACTICES; i++){
      const key = 'practice-'+i;
      const item = state.items[key];
      if (!item) continue;
      const el = document.createElement('div'); el.className = 'item'; el.dataset.key = key;
      const left = document.createElement('div'); left.className = 'left';
      const badge = document.createElement('div'); badge.className = 'badge'; badge.textContent = 'P'+i;
      if (item.completed) badge.classList.add('complete');
      const meta = document.createElement('div'); meta.className = 'meta';
      const name = document.createElement('div'); name.className = 'name'; name.textContent = item.title;
      const small = document.createElement('div'); small.className = 'small'; small.textContent = item.desc;
      meta.appendChild(name); meta.appendChild(small);
      left.appendChild(badge); left.appendChild(meta);
      const right = document.createElement('div'); right.className = 'right';
      const a = document.createElement('a'); a.href = item.href || '#'; a.textContent = 'Открыть'; a.className = 'link'; a.target = '_blank';
      right.appendChild(a);
      el.appendChild(left); el.appendChild(right);
      el.addEventListener('click', (e) => {
        if (e.target && e.target.tagName === 'A') return;
        openDetail(key);
      });
      practicesDiv.appendChild(el);
    }
    if (filter === 'lessons') { container.appendChild(lessonsDiv); }
    else if (filter === 'practices') { container.appendChild(practicesDiv); }
    else { container.appendChild(lessonsDiv); container.appendChild(practicesDiv); }
  }
  function openDetail(key){
    const item = state.items[key];
    if (!item) return;
    document.getElementById('detailTitle').textContent = item.title || '';
    document.getElementById('detailSub').textContent = item.desc || '';
    const detailBody = document.getElementById('detailBody');
    detailBody.innerHTML = '';
    const p = document.createElement('div'); p.textContent = item.desc || '';
    detailBody.appendChild(p);
    if (item.content){
      const pre = document.createElement('pre');
      pre.style.marginTop = '10px';
      pre.style.whiteSpace = 'pre-wrap';
      pre.style.fontFamily = 'monospace';
      pre.style.color = 'var(--muted)';
      pre.textContent = item.content;
      detailBody.appendChild(pre);
    }
    const openHref = document.getElementById('openHref');
    openHref.href = item.href || '#';
    document.getElementById('detailActions').style.display = 'flex';
    document.getElementById('commentArea').style.display = 'flex';
    const markBtn = document.getElementById('markBtn');
    markBtn.style.display = 'inline-block';
    markBtn.textContent = item.completed ? 'Снять отметку' : 'Отметить как пройдено';
    markBtn.onclick = () => toggleComplete(key);
    const comments = getCommentsFor(key);
    renderComments(comments);
    document.getElementById('saveComment').onclick = () => saveCommentFor(key);
    document.getElementById('clearComments').onclick = () => clearCommentsFor(key);
    if (item.type === 'lesson') state.currentLesson = item.id || state.currentLesson;
    else if (item.type === 'practice') state.currentPractice = item.id || state.currentPractice;
    saveState(state);
  }
  function toggleComplete(key){
    const item = state.items[key];
    if (!item) return;
    item.completed = !item.completed;
    recalcCounts(state);
    saveState(state);
    renderList(currentFilter);
    openDetail(key);
    checkCongrats();
  }
  function getCommentsFor(key){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      const obj = JSON.parse(raw);
      return (obj.items && obj.items[key] && obj.items[key].comments) ? obj.items[key].comments : [];
    } catch(e){
      return [];
    }
  }
  function saveCommentFor(key){
    const text = document.getElementById('commentInput').value.trim();
    if (!text) return;
    state.items[key].comments = state.items[key].comments || [];
    state.items[key].comments.push({ text, date: new Date().toISOString() });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    document.getElementById('commentInput').value = '';
    renderComments(state.items[key].comments);
  }
  function clearCommentsFor(key){
    if (state.items[key]) state.items[key].comments = [];
    saveState();
    renderComments([]);
  }
  function renderComments(list){
    const el = document.getElementById('commentList');
    el.innerHTML = '';
    if (!list || list.length === 0) {
      el.innerHTML = '<div class="small">Комментариев пока нет</div>';
      return;
    }
    list.slice().reverse().forEach(c => {
      const d = document.createElement('div'); d.className = 'comment';
      const t = document.createElement('div'); t.textContent = c.text;
      const meta = document.createElement('div'); meta.className = 'small'; meta.style.marginTop = '8px';
      meta.textContent = (new Date(c.date)).toLocaleString();
      d.appendChild(t); d.appendChild(meta); el.appendChild(d);
    });
  }
  function updateProgressVisual(){
    const done = state.lessonsCompleted + state.practicesCompleted;
    const total = TOTAL_LESSONS + TOTAL_PRACTICES;
    const pct = Math.round(total === 0 ? 0 : (done / total * 100));
    const ring = document.getElementById('progressRing');
    const number = document.getElementById('progressNumber');
    const circumference = 2 * Math.PI * 50;
    const offset = circumference - (pct / 100) * circumference;
    if (ring) ring.style.strokeDashoffset = offset;
    if (number) number.textContent = pct + '%';
    document.getElementById('progressText').textContent = `${done} из ${total} завершено`;
    const bars = document.getElementById('progressBars'); bars.innerHTML = '';
    const lbar = document.createElement('div'); lbar.style.height = '8px'; lbar.style.width = '200px'; lbar.style.background = 'rgba(255,255,255,0.03)'; lbar.style.borderRadius = '8px'; lbar.style.overflow = 'hidden';
    const inner = document.createElement('div'); inner.style.height = '100%'; inner.style.width = `${pct}%`; inner.style.background = 'linear-gradient(90deg,#fff,#ddd)'; inner.style.transition = 'width .6s';
    lbar.appendChild(inner); bars.appendChild(lbar);
  }
  function checkCongrats(){
    const done = state.lessonsCompleted + state.practicesCompleted;
    const total = TOTAL_LESSONS + TOTAL_PRACTICES;
    if (done >= total){
      document.getElementById('congratsModal').style.display = 'flex';
    }
  }
  document.getElementById('btnLessons').addEventListener('click', () => {
    currentFilter = 'lessons';
    document.getElementById('btnLessons').classList.add('active');
    document.getElementById('btnPractices').classList.remove('active');
    document.getElementById('btnAll').classList.remove('active');
    renderList('lessons');
  });
  document.getElementById('btnPractices').addEventListener('click', () => {
    currentFilter = 'practices';
    document.getElementById('btnPractices').classList.add('active');
    document.getElementById('btnLessons').classList.remove('active');
    document.getElementById('btnAll').classList.remove('active');
    renderList('practices');
  });
  document.getElementById('btnAll').addEventListener('click', () => {
    currentFilter = 'all';
    document.getElementById('btnAll').classList.add('active');
    document.getElementById('btnLessons').classList.remove('active');
    document.getElementById('btnPractices').classList.remove('active');
    renderList('all');
  });
  document.getElementById('saveIdea').addEventListener('click', () => {
    const v = document.getElementById('ideaInput').value;
    localStorage.setItem(IDEAS_KEY, v);
    alert('Идея сохранена в браузере');
  });
  document.getElementById('clearIdea').addEventListener('click', () => {
    document.getElementById('ideaInput').value = '';
    localStorage.removeItem(IDEAS_KEY);
  });
  document.getElementById('resetBtn').addEventListener('click', () => {
    if (!confirm('Сбросить прогресс и комментарии?')) return;
    localStorage.removeItem(STORAGE_KEY);
    localStorage.removeItem(IDEAS_KEY);
    state = loadState();
    saveState();
    alert('Сброшено');
  });
  document.getElementById('exportBtn').addEventListener('click', () => {
    const data = JSON.stringify(state, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'js_course_progress.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });
  document.getElementById('closeCongrats').addEventListener('click', () => { document.getElementById('congratsModal').style.display = 'none'; });
  document.getElementById('exportCongrats').addEventListener('click', () => {
    const text = `Поздравляю! Пройден курс ${new Date().toLocaleDateString()}\nУроки: ${state.lessonsCompleted}/${TOTAL_LESSONS}\nПрактики: ${state.practicesCompleted}/${TOTAL_PRACTICES}`;
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'congrats.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });
  function animateIntro(){
    const rings = document.querySelectorAll('.item');
    rings.forEach((r, i) => {
      r.style.transform = 'translateY(8px)';
      r.style.opacity = '0';
      setTimeout(() => {
        r.style.transition = 'all .45s cubic-bezier(.2,.9,.3,1)';
        r.style.transform = 'translateY(0)';
        r.style.opacity = '1';
      }, i * 20);
    });
  }
  window.addEventListener('load', () => {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        state = JSON.parse(saved);
        ensureAllItems(state);
        recalcCounts(state);
      }
    } catch (e) {
      console.warn('load on start error', e);
    }
    updateUI();
    checkCongrats();
  });
  const observer = new MutationObserver((mut) => {
    const el = document.getElementById('trackerWrapper');
    if (el && getComputedStyle(el).display !== 'none') {
      setTimeout(() => { renderList(currentFilter); animateIntro(); }, 150);
      observer.disconnect();
    }
  });
  observer.observe(document.body, { attributes: true, childList: true, subtree: true });
  </script>
</body>
</html>
